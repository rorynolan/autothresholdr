<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thresholding Image Stacks • autothresholdr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Thresholding Image Stacks">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">autothresholdr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/finding-thresholds.html">Finding Thresholds</a>
    </li>
    <li>
      <a href="../articles/thresholding-image-stacks.html">Thresholding Image Stacks</a>
    </li>
    <li>
      <a href="../articles/thresholding-images.html">Thresholding Images</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rorynolan/autothresholdr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Thresholding Image Stacks</h1>
            
            <h4 data-toc-skip class="date">2025-09-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rorynolan/autothresholdr/blob/master/vignettes/thresholding-image-stacks.Rmd" class="external-link"><code>vignettes/thresholding-image-stacks.Rmd</code></a></small>
      <div class="hidden name"><code>thresholding-image-stacks.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="stacks-of-images">Stacks of Images<a class="anchor" aria-label="anchor" href="#stacks-of-images"></a>
</h2>
<p><code>50.tif</code> is a TIFF file which is a stack of 50 images of a
bit of a cell taken over a short space of time (i.e. it’s a video).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu">ijtiff</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/ijtiff/reference/read_tif.html" class="external-link">read_tif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"50.tif"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"autothresholdr"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading image from /home/runner/work/_temp/Library/autothresholdr/extdata/50.tif</span></span>
<span><span class="co">#&gt; Reading an 8-bit, float image with dimensions 100x100x1x50 (y,x,channel,frame) . . .</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100 100   1  50</span></span></code></pre></div>
<p>Let’s display the first 3 frames:</p>
<p><img src="thresholding-image-stacks_files/figure-html/first-3-frames-1.png" width="672"></p>
<p>and the last 3 frames:</p>
<p><img src="thresholding-image-stacks_files/figure-html/last-3-frames-1.png" width="672"></p>
<p>You’ll notice that these images are almost identical. That’s because
they’re images of the same area taken very quickly one after another.
There are two ways to threshold an image stack like this. One is the
naiive way: find a threshold based on every pixel in the stack, then
pixels below the threshold are excluded (set to <code>NA</code>). Let’s
try that:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rorynolan.github.io/autothresholdr/" class="external-link">autothresholdr</a></span><span class="op">)</span></span>
<span><span class="va">naiively_threshed_img</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_thresh.html">apply_mask</a></span><span class="op">(</span><span class="va">img</span>, <span class="st">"tri"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">naiively_threshed_img</span>, <span class="st">"thresh"</span><span class="op">)</span> <span class="co"># The threshold chosen by "Triangle" is 4</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; attr(,"ignore_black")</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; attr(,"ignore_white")</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; attr(,"ignore_na")</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; attr(,"autothresh_method")</span></span>
<span><span class="co">#&gt; [1] "Triangle"</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "th"      "integer"</span></span></code></pre></div>
<p>Now let’s display the first 3 frames and the last 3 frames:</p>
<p><img src="thresholding-image-stacks_files/figure-html/naiive-first-3-frames-1.png" width="672"></p>
<p><img src="thresholding-image-stacks_files/figure-html/naiive-last-3-frames-1.png" width="672"></p>
<p>If you look closely, you can see that the threshold mask is
(slightly) different for different frames. Let’s highlight the pixels
which are sometimes thresholded away, sometimes not:</p>
<p><img src="thresholding-image-stacks_files/figure-html/sometimes-sometimes-not-1.png" width="672"></p>
<p>So (unsurprisingly), it seems that around the edges of the cell
(where the signal from the cell is more feint), the pixels are sometimes
thresholded away, sometimes not. There are also some seemingly random
pixels within the cell which are sometimes thresholded away, sometimes
not.</p>
<p>Now, given that you know that the cell is more or less stationary and
you want the threshold to get rid of the <em>non-cell</em> bits and keep
the <em>cell</em> bits, its reasonable to assert that the mask should be
the same for every frame. It’s possible to apply the same mask to every
frame, and to compute this mask, it makes sense to incorporate
information from all of the frames. This is what
<code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code> and <code><a href="../reference/med_stack_thresh.html">med_stack_thresh()</a></code> do.
<code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code> computes the mask based on the mean of
all of the frames (gotten by calculating the mean intensity of the stack
at each pixel position). <code><a href="../reference/med_stack_thresh.html">med_stack_thresh()</a></code> uses the median
instead of the mean. They’re both very similar. If you don’t know which
one to use, just use <code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code>.</p>
<p>Let’s visualize them both:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ijtiff</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/ijtiff/reference/display.html" class="external-link">display</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean_stack_thresh.html">mean_stack_thresh</a></span><span class="op">(</span><span class="va">img</span>, <span class="st">"tri"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="thresholding-image-stacks_files/figure-html/stack-threshs-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ijtiff</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/ijtiff/reference/display.html" class="external-link">display</a></span><span class="op">(</span><span class="fu"><a href="../reference/med_stack_thresh.html">med_stack_thresh</a></span><span class="op">(</span><span class="va">img</span>, <span class="st">"tri"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="thresholding-image-stacks_files/figure-html/stack-threshs-2.png" width="672"></p>
<p>You can see that the results of <code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code> and
<code><a href="../reference/med_stack_thresh.html">med_stack_thresh()</a></code> are similar but not identical. Both do a
fine job.</p>
<p>Note that if the cell (or whatever is recorded over the course of
several frames) is not stationary (or almost stationary), then
<code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code> and <code><a href="../reference/med_stack_thresh.html">med_stack_thresh()</a></code> are
not appropriate.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rory Nolan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
