<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Threshold every image frame in a stack based on their median. — med_stack_thresh • autothresholdr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Threshold every image frame in a stack based on their median. — med_stack_thresh" />
<meta property="og:description" content="An ijtiff_img is a 4-dimensional array indexed by
img[y, x, channel, frame]. For each channel (which consists of a stack of
frames), this function finds a threshold based on all of the frames, then
takes the median of all the frames in the stack image, uses this to create a
mask with the found threshold and then applies this mask to every frame in
the stack (so for a given pillar in the image stack, either all the pixels
therein are thresholded away or all are untouched, where pillar x,y of
channel ch is img[y, x, ch, ])." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">autothresholdr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/finding-thresholds.html">Finding Thresholds</a>
    </li>
    <li>
      <a href="../articles/thresholding-image-stacks.html">Thresholding Image Stacks</a>
    </li>
    <li>
      <a href="../articles/thresholding-images.html">Thresholding Images</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rorynolan/autothresholdr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Threshold every image frame in a stack based on their median.</h1>
    <small class="dont-index">Source: <a href='https://github.com/rorynolan/autothresholdr/blob/master/R/stack_thresh.R'><code>R/stack_thresh.R</code></a></small>
    <div class="hidden name"><code>med_stack_thresh.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>An <a href='https://docs.ropensci.org/ijtiff/reference/ijtiff_img.html'>ijtiff_img</a> is a 4-dimensional array indexed by
<code>img[y, x, channel, frame]</code>. For each channel (which consists of a stack of
frames), this function finds a threshold based on all of the frames, then
takes the median of all the frames in the stack image, uses this to create a
mask with the found threshold and then applies this mask to every frame in
the stack (so for a given pillar in the image stack, either all the pixels
therein are thresholded away or all are untouched, where pillar <code>x,y</code> of
channel <code>ch</code> is <code>img[y, x, ch, ]</code>).</p>
    </div>

    <pre class="usage"><span class='fu'>med_stack_thresh</span><span class='op'>(</span>
  <span class='va'>img</span>,
  <span class='va'>method</span>,
  fail <span class='op'>=</span> <span class='cn'>NA</span>,
  ignore_black <span class='op'>=</span> <span class='cn'>FALSE</span>,
  ignore_white <span class='op'>=</span> <span class='cn'>FALSE</span>,
  ignore_na <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>img</th>
      <td><p>A 3-dimensional array (the image stack, possibly a time-series of
images) where the \(n\)th slice is the \(n\)th image in the stack.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The name of the thresholding method you wish to use. The
available methods are <code>"IJDefault"</code>, <code>"Huang"</code>, <code>"Huang2"</code>, <code>"Intermodes"</code>,
<code>"IsoData"</code>, <code>"Li"</code>, <code>"MaxEntropy"</code>, <code>"Mean"</code>, <code>"MinErrorI"</code>, <code>"Minimum"</code>,
<code>"Moments"</code>, <code>"Otsu"</code>, <code>"Percentile"</code>, <code>"RenyiEntropy"</code>, <code>"Shanbhag"</code>,
<code>"Triangle"</code> and <code>"Yen"</code>. Partial matching is performed i.e. <code>method = "h"</code>
is enough to get you <code>"Huang"</code> and <code>method = "in"</code> is enough to get you
<code>"Intermodes"</code>. To perform <em>manual</em> thresholding (where you set the
threshold yourself), supply the threshold here as a number e.g. <code>method = 3</code> (so note that this would <em>not</em> select the third method in the above
list of methods). This manual threshold will then be used to threshold the
median stack to create a 2D mask and then this mask will be applied to all
frames in the stack. If you want a different method for each channel,
specify this parameter as a vector or list, one element per channel.</p></td>
    </tr>
    <tr>
      <th>fail</th>
      <td><p>When using <code><a href='auto_thresh.html'>auto_thresh_apply_mask()</a></code>, to what value do you wish
to set the pixels which fail to exceed the threshold? <code>fail = 'saturate'</code>
sets them to saturated value (see 'Details'). <code>fail = 'zero'</code> sets them to
zero. You can also specify directly here a natural number (must be between
<code>0</code> and <code>2^32 - 1</code>) to use.</p></td>
    </tr>
    <tr>
      <th>ignore_black</th>
      <td><p>Ignore black pixels/elements (zeros) when performing the
thresholding?</p></td>
    </tr>
    <tr>
      <th>ignore_white</th>
      <td><p>Ignore white pixels when performing the thresholding? If
set to <code>TRUE</code>, the function makes a good guess as to what the white
(saturated) value would be (see 'Details').</p></td>
    </tr>
    <tr>
      <th>ignore_na</th>
      <td><p>This should be <code>TRUE</code> if <code>NA</code>s in <code>int_arr</code> should be
ignored or <code>FALSE</code> if you want the presence of <code>NA</code>s in <code>int_arr</code> to throw
an error.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <a href='stack_threshed_img.html'>stack_threshed_img</a> which is the thresholded
image (an array in the style of an <a href='https://docs.ropensci.org/ijtiff/reference/ijtiff_img.html'>ijtiff_img</a>).
Pillars not exceeding the threshold are set to the <code>fail</code> value (default
<code>NA</code>).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    
<ul>
<li><p>For <code>ignore_white = TRUE</code>, if the maximum value in the array is one of
<code>2^8-1</code>, <code>2^16-1</code> or <code>2^32-1</code>, then those max values are ignored.
That's because they're the white values in 8, 16 and 32-bit images
respectively (and these are the common image bit sizes to work with). This
guesswork has to be done because <code>R</code> does not know how many bits the image
was on disk. This guess is very unlikely to be wrong, and if it is, the
consequences are negligible anyway. If you're very concerned, then just
specify the white value as an integer in this <code>ignore_white</code> argument.</p></li>
<li><p>If you have set <code>ignore_black = TRUE</code> and/or <code>ignore_white = TRUE</code> but
you are still getting error/warning messages telling you to try them, then
your chosen method is not working for the given array, so you should try a
different method.</p></li>
<li><p>For a given array, if all values are less than <code>2^8</code>, saturated value
is <code>2^8 - 1</code>, otherwise, saturated value is <code>2^16 - 1</code>.</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='co'># \donttest{</span></span>
<span class='r-in'><span class='va'>img</span> <span class='op'>&lt;-</span> <span class='fu'>ijtiff</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/ijtiff/reference/read_tif.html'>read_tif</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"50.tif"</span>,</span>
<span class='r-in'>  package <span class='op'>=</span> <span class='st'>"autothresholdr"</span></span>
<span class='r-in'><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Reading 50.tif: an 8-bit, 100x100 pixel image of unsigned</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> integer type. Reading 1 channel and 50 frames . . .</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  Done.</span>
<span class='r-in'><span class='fu'>ijtiff</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/ijtiff/reference/display.html'>display</a></span><span class='op'>(</span><span class='va'>img</span><span class='op'>[</span>, , <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using basic display functionality.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   * For better display functionality, install the EBImage package.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   * To install `EBImage`:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>     - Install `BiocManager` with `install.packages("BiocManager")`.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>     - Then run `BiocManager::install("EBImage")`.</span>
<span class='r-plt img'><img src='med_stack_thresh-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='va'>img_thresh_mask</span> <span class='op'>&lt;-</span> <span class='fu'>med_stack_thresh</span><span class='op'>(</span><span class='va'>img</span>, <span class='st'>"Otsu"</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'>ijtiff</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/ijtiff/reference/display.html'>display</a></span><span class='op'>(</span><span class='va'>img_thresh_mask</span><span class='op'>[</span>, , <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using basic display functionality.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   * For better display functionality, install the EBImage package.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   * To install `EBImage`:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>     - Install `BiocManager` with `install.packages("BiocManager")`.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>     - Then run `BiocManager::install("EBImage")`.</span>
<span class='r-plt img'><img src='med_stack_thresh-2.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='fu'>ijtiff</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/ijtiff/reference/display.html'>display</a></span><span class='op'>(</span><span class='va'>img</span><span class='op'>[</span>, , <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using basic display functionality.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   * For better display functionality, install the EBImage package.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   * To install `EBImage`:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>     - Install `BiocManager` with `install.packages("BiocManager")`.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>     - Then run `BiocManager::install("EBImage")`.</span>
<span class='r-plt img'><img src='med_stack_thresh-3.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='va'>img_thresh_mask</span> <span class='op'>&lt;-</span> <span class='fu'>med_stack_thresh</span><span class='op'>(</span><span class='va'>img</span>, <span class='st'>"Triangle"</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'>ijtiff</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/ijtiff/reference/display.html'>display</a></span><span class='op'>(</span><span class='va'>img_thresh_mask</span><span class='op'>[</span>, , <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using basic display functionality.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   * For better display functionality, install the EBImage package.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   * To install `EBImage`:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>     - Install `BiocManager` with `install.packages("BiocManager")`.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>     - Then run `BiocManager::install("EBImage")`.</span>
<span class='r-plt img'><img src='med_stack_thresh-4.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Rory Nolan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


